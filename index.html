<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Gone Note</title>
  <meta name="description" content="A simple service that can parse any article into Reading Mode." />
  <meta name="author" content="kirilov.ml" />
  <meta name="theme-color" content="#0d6efd" />

  <meta property="og:title" content="Gone Note" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="" />
  <meta property="og:description" content="A simple service that can parse any article into Reading Mode." />
  <meta property="og:image" content="" />

  <link rel="icon" href="favicon.svg" type="image/svg+xml />
    <link rel=" manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="favicon-192px.png" />

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous" />
</head>

<body>
  <div class="container text-center pt-3" id="statusMessage" style="display: none;">
    <div class="spinner-border" role="status"></div>
  </div>

  <div id="viewForm" class="container">
    <section class="py-4 py-xl-5 container">

      <div class="col-md-8 col-xl-6 text-center mx-auto">
        <h2 class="display-6 fw-bold">Gone Note</h2>
        <p class="text-muted">
          Notes are encrypted in your browser and the key is never sent to the server when the note is stored in the
          database.
        </p>
      </div>

      <form id="noteSave" class="col-md-8 col-xl-6 text-center mx-auto">
        <div class="form-group">
          <label for="noteClearText">Note</label>
          <textarea class="form-control" id="noteClearText" rows="6"></textarea>
        </div>
        <div class="form-group">
          <label for="ttl">Days before deleted (1-90):</label>
          <input type="number" class="form-control" id="ttl" min="1" max="90" value="30">
        </div>
        <div class="form-group">
          <label for="reads">Times read before deleted (1-5):</label>
          <input type="number" class="form-control" id="reads" min="1" max="5" value="1">
        </div>
        <br>
        <button type="submit" class="btn btn-primary" onclick="formSubmit();return false">Submit</button>
      </form>
    </section>
  </div>

  <script>
    document.getElementById('statusMessage').style.display = "none";

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    function formSubmit() {
      console.log("form submitted")
      document.getElementById('statusMessage').style.display = "block";
      fetchNotePost();
    };

    function fetchNotePost() {
      console.log("gonna post note");
      console.log(document.getElementById('noteClearText').value);
      console.log(document.getElementById('reads').value);
      console.log(document.getElementById('ttl').value);
      const url = 'https://dawn-leaf-fb26.ml4den.workers.dev/';

      if (url !== null) {
        console.log("gonna fetch")
        let formData = new FormData();
        formData.append('note', 'Jason');
        formData.append('views', '4');

        fetch(url,{
          body: formData,
          method: "post",
        })
          .then(handleErrors)
          .then(function (response) {
            return response.json();
          })
          .then(function (jsonResponse) {
            // do something with jsonResponse
            document.getElementById("statusMessage").style.display = "none";
            console.log("fetch went well")
            console.log(jsonResponse)
          })
          .catch(function (error) {
            console.log(error);
            document.getElementById("statusMessage").innerHTML = error;
          });
      }


    };

    function handleErrors(response) {
      if (!response.ok) {
        document.getElementById("statusMessage").innerHTML = response.statusText;
        throw Error(response.statusText);
      }
      return response;
    };
  </script>
</body>

</html>